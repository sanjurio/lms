{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="section">
    <h1 class="section-title">{{ 'Edit Lesson' if lesson else 'Add New Lesson' }}</h1>
    
    <div class="admin-nav">
        <ul>
            <li><a href="{{ url_for('admin_dashboard') }}">Dashboard</a></li>
            <li><a href="{{ url_for('admin_users') }}">Users</a></li>
            <li><a href="{{ url_for('admin_pending_users') }}">Pending Users</a></li>
            <li><a href="{{ url_for('admin_courses') }}" class="active">Courses</a></li>
            <li><a href="{{ url_for('admin_interests') }}">Teams</a></li>
            <li><a href="{{ url_for('admin_user_interest_requests') }}">Teams Requests</a></li>
            <li><a href="{{ url_for('admin_mandatory_courses') }}">Mandatory Courses</a></li>
        </ul>
    </div>
    
    <div class="admin-container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('admin_courses') }}">Courses</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('admin_lessons', course_id=course.id) }}">{{ course.title }} Lessons</a></li>
                <li class="breadcrumb-item active">{{ 'Edit Lesson' if lesson else 'Add Lesson' }}</li>
            </ol>
        </nav>
        
        <div class="admin-form-container">
            <form method="post" action="">
                {{ form.hidden_tag() }}
                
                <div class="form-group">
                    {{ form.title.label(class="form-label") }}
                    {{ form.title(class="form-control") }}
                    <div class="error-message">
                        {% for error in form.title.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                </div>
                
                <div class="form-group">
                    {{ form.order.label(class="form-label") }}
                    {{ form.order(class="form-control", type="number") }}
                    <div class="form-text">The order in which this lesson appears in the course (e.g., 1 for first lesson)</div>
                    <div class="error-message">
                        {% for error in form.order.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                </div>
                
                <div class="form-group">
                    {{ form.content.label(class="form-label") }}
                    
                    <div class="inline-media-toolbar">
                        <span class="toolbar-label">Insert Media:</span>
                        <button type="button" class="inline-media-btn" onclick="showYouTubeDialog()" title="Insert YouTube Video">
                            <i class="fab fa-youtube"></i> YouTube
                        </button>
                        <button type="button" class="inline-media-btn" onclick="showOneDriveDialog()" title="Insert OneDrive/External Video">
                            <i class="fab fa-microsoft"></i> OneDrive
                        </button>
                        <button type="button" class="inline-media-btn" onclick="showFileDialog()" title="Insert File Download">
                            <i class="fas fa-file-download"></i> File
                        </button>
                        <button type="button" class="inline-media-btn" onclick="showLinkDialog()" title="Insert External Link">
                            <i class="fas fa-external-link-alt"></i> Docs Link
                        </button>
                    </div>
                    
                    <textarea id="content" name="{{ form.content.name }}" style="display:none;">{{ form.content.data|e }}</textarea>
                    <div id="quill-editor" class="quill-dark" aria-label="Lesson content editor"></div>
                    <div class="form-text">Use the toolbar above to insert videos, files, and links inline within your content. They will appear exactly where you place your cursor.</div>

                    <div class="error-message">
                        {% for error in form.content.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                </div>
                
                <div class="form-group">
                    {{ form.submit(class="btn btn-primary") }}
                    <a href="{{ url_for('admin_lessons', course_id=course.id) }}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
        
    </div>
</div>

<!-- YouTube Dialog -->
<div id="youtube-dialog" class="media-dialog hidden">
    <div class="media-dialog-content">
        <h4><i class="fab fa-youtube text-danger"></i> Insert YouTube Video</h4>
        <div class="form-group">
            <label class="form-label">YouTube URL</label>
            <input type="text" id="inline-youtube-url" class="form-control" placeholder="https://youtube.com/watch?v=... or https://youtu.be/...">
        </div>
        <div class="form-group">
            <label class="form-label">Title (optional)</label>
            <input type="text" id="inline-youtube-title" class="form-control" placeholder="Video title">
        </div>
        <div class="dialog-buttons">
            <button type="button" class="btn btn-secondary" onclick="closeDialog('youtube-dialog')">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="insertYouTubeInline()">Insert Video</button>
        </div>
    </div>
</div>

<!-- OneDrive/External Video Dialog -->
<div id="onedrive-dialog" class="media-dialog hidden">
    <div class="media-dialog-content">
        <h4><i class="fab fa-microsoft text-primary"></i> Insert Video Embed</h4>
        <p class="text-muted">For OneDrive: Right-click video > Share > Embed > Copy the embed URL or full iframe code</p>
        <div class="form-group">
            <label class="form-label">Embed URL or Iframe Code</label>
            <textarea id="inline-embed-code" class="form-control" rows="3" placeholder="Paste embed URL or full iframe code here..."></textarea>
        </div>
        <div class="form-group">
            <label class="form-label">Title (optional)</label>
            <input type="text" id="inline-embed-title" class="form-control" placeholder="Video title">
        </div>
        <div class="dialog-buttons">
            <button type="button" class="btn btn-secondary" onclick="closeDialog('onedrive-dialog')">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="insertEmbedInline()">Insert Video</button>
        </div>
    </div>
</div>

<!-- File Dialog -->
<div id="file-dialog" class="media-dialog hidden">
    <div class="media-dialog-content">
        <h4><i class="fas fa-file-download text-primary"></i> Insert File Download</h4>
        <div class="form-group">
            <label class="form-label">Select from uploaded files or enter URL</label>
            <select id="inline-file-select" class="form-control">
                <option value="">-- Select uploaded file --</option>
            </select>
        </div>
        <div class="form-group">
            <label class="form-label">Or paste file URL directly</label>
            <input type="text" id="inline-file-url" class="form-control" placeholder="https://example.com/file.pdf">
        </div>
        <div class="form-group">
            <label class="form-label">Display Text</label>
            <input type="text" id="inline-file-title" class="form-control" placeholder="Click here to download">
        </div>
        <div class="dialog-buttons">
            <button type="button" class="btn btn-secondary" onclick="closeDialog('file-dialog')">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="insertFileInline()">Insert File</button>
        </div>
    </div>
</div>

<!-- Link Dialog -->
<div id="link-dialog" class="media-dialog hidden">
    <div class="media-dialog-content">
        <h4><i class="fas fa-external-link-alt text-info"></i> Insert External Link</h4>
        <div class="form-group">
            <label class="form-label">URL</label>
            <input type="text" id="inline-link-url" class="form-control" placeholder="https://...">
        </div>
        <div class="form-group">
            <label class="form-label">Link Text</label>
            <input type="text" id="inline-link-title" class="form-control" placeholder="Click here">
        </div>
        <div class="form-group">
            <label class="form-check">
                <input type="checkbox" id="inline-link-newwindow" checked>
                <span>Open in new window</span>
            </label>
        </div>
        <div class="dialog-buttons">
            <button type="button" class="btn btn-secondary" onclick="closeDialog('link-dialog')">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="insertLinkInline()">Insert Link</button>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>

<script>
let quill;

(function () {
    const textarea = document.getElementById('content');
    const initialHtml = textarea.value || '';

    quill = new Quill('#quill-editor', {
        theme: 'snow',
        modules: {
            toolbar: [
                [{ header: [1, 2, 3, false] }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ list: 'ordered' }, { list: 'bullet' }],
                ['blockquote', 'code-block'],
                ['link', 'image'],
                ['clean']
            ]
        }
    });

    quill.root.innerHTML = initialHtml;

    const form = textarea.closest('form');
    form.addEventListener('submit', function (e) {
        textarea.value = quill.root.innerHTML;
    });

    quill.root.setAttribute('aria-label', 'Lesson content editable area');
})();

// Dialog functions
function showYouTubeDialog() {
    document.getElementById('inline-youtube-url').value = '';
    document.getElementById('inline-youtube-title').value = '';
    document.getElementById('youtube-dialog').classList.remove('hidden');
}

function showOneDriveDialog() {
    document.getElementById('inline-embed-code').value = '';
    document.getElementById('inline-embed-title').value = '';
    document.getElementById('onedrive-dialog').classList.remove('hidden');
}

function showFileDialog() {
    document.getElementById('inline-file-url').value = '';
    document.getElementById('inline-file-title').value = '';
    populateFileSelect();
    document.getElementById('file-dialog').classList.remove('hidden');
}

function showLinkDialog() {
    document.getElementById('inline-link-url').value = '';
    document.getElementById('inline-link-title').value = '';
    document.getElementById('link-dialog').classList.remove('hidden');
}

function closeDialog(dialogId) {
    document.getElementById(dialogId).classList.add('hidden');
}

// Close dialogs when clicking outside
document.querySelectorAll('.media-dialog').forEach(dialog => {
    dialog.addEventListener('click', function(e) {
        if (e.target === this) {
            this.classList.add('hidden');
        }
    });
});

// Extract YouTube video ID
function getYouTubeEmbedUrl(url) {
    let videoId = null;
    url = url.trim();
    
    if (url.includes('youtu.be/')) {
        videoId = url.split('youtu.be/')[1].split('?')[0];
    } else if (url.includes('youtube.com/watch')) {
        const match = url.match(/v=([^&]+)/);
        if (match) videoId = match[1];
    } else if (url.includes('youtube.com/embed/')) {
        videoId = url.split('embed/')[1].split('?')[0];
    }
    
    return videoId ? `https://www.youtube.com/embed/${videoId}` : null;
}

function insertYouTubeInline() {
    const url = document.getElementById('inline-youtube-url').value.trim();
    const title = document.getElementById('inline-youtube-title').value.trim();
    
    if (!url) {
        alert('Please enter a YouTube URL');
        return;
    }
    
    const embedUrl = getYouTubeEmbedUrl(url);
    if (!embedUrl) {
        alert('Invalid YouTube URL. Please use a youtube.com or youtu.be link.');
        return;
    }
    
    const html = `
<div class="embedded-video" data-type="youtube">
    ${title ? `<p class="video-caption"><strong>${title}</strong></p>` : ''}
    <div class="video-container">
        <iframe src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
</div>
<p><br></p>
`;
    
    insertHtmlAtCursor(html);
    closeDialog('youtube-dialog');
}

function insertEmbedInline() {
    let embedCode = document.getElementById('inline-embed-code').value.trim();
    const title = document.getElementById('inline-embed-title').value.trim();
    
    if (!embedCode) {
        alert('Please enter an embed URL or iframe code');
        return;
    }
    
    let iframeHtml = '';
    
    // Check if it's already an iframe
    if (embedCode.includes('<iframe')) {
        // Extract and use the iframe, but ensure it has proper attributes
        iframeHtml = embedCode;
    } else {
        // It's just a URL, create an iframe
        iframeHtml = `<iframe src="${embedCode}" frameborder="0" allowfullscreen></iframe>`;
    }
    
    const html = `
<div class="embedded-video" data-type="external">
    ${title ? `<p class="video-caption"><strong>${title}</strong></p>` : ''}
    <div class="video-container">
        ${iframeHtml}
    </div>
</div>
<p><br></p>
`;
    
    insertHtmlAtCursor(html);
    closeDialog('onedrive-dialog');
}

function insertFileInline() {
    const selectEl = document.getElementById('inline-file-select');
    const urlInput = document.getElementById('inline-file-url').value.trim();
    const title = document.getElementById('inline-file-title').value.trim() || 'Download File';
    
    let fileUrl = '';
    let fileName = title;
    
    if (selectEl.value) {
        // Use selected file from library
        const option = selectEl.options[selectEl.selectedIndex];
        fileUrl = option.dataset.url;
        fileName = title || option.text;
    } else if (urlInput) {
        fileUrl = urlInput;
    } else {
        alert('Please select a file or enter a URL');
        return;
    }
    
    const html = `<div class="embedded-file"><a href="${fileUrl}" class="file-download-link" download><i class="fas fa-file-download"></i> ${fileName}</a></div>`;
    
    insertHtmlAtCursor(html);
    closeDialog('file-dialog');
}

function insertLinkInline() {
    const url = document.getElementById('inline-link-url').value.trim();
    const title = document.getElementById('inline-link-title').value.trim() || url;
    const newWindow = document.getElementById('inline-link-newwindow').checked;
    
    if (!url) {
        alert('Please enter a URL');
        return;
    }
    
    const target = newWindow ? ' target="_blank" rel="noopener noreferrer"' : '';
    const html = `<a href="${url}"${target}>${title}</a>`;
    
    insertHtmlAtCursor(html);
    closeDialog('link-dialog');
}

function insertHtmlAtCursor(html) {
    const range = quill.getSelection(true);
    quill.clipboard.dangerouslyPasteHTML(range.index, html);
    quill.setSelection(range.index + 1);
}

function populateFileSelect() {
    const select = document.getElementById('inline-file-select');
    select.innerHTML = '<option value="">-- Select uploaded file --</option>';
    
    {% if lesson %}
    fetch(`/api/lessons/{{ lesson.id }}/media`, {
        headers: { 'X-CSRFToken': '{{ csrf_token() }}' }
    })
    .then(response => response.json())
    .then(data => {
        data.media.filter(m => m.media_type === 'file').forEach(file => {
            const option = document.createElement('option');
            option.value = file.id;
            option.text = file.title || file.file_name;
            option.dataset.url = `/static/${file.file_path || ''}`;
            select.appendChild(option);
        });
    });
    {% endif %}
}

{% if lesson %}
const lessonId = {{ lesson.id }};
const csrfToken = '{{ csrf_token() }}';

document.querySelectorAll('.media-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        document.querySelectorAll('.media-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.media-tab-content').forEach(c => c.classList.add('hidden'));
        
        this.classList.add('active');
        document.getElementById(this.dataset.tab + '-tab').classList.remove('hidden');
    });
});

function loadMediaItems() {
    fetch(`/api/lessons/${lessonId}/media`, {
        headers: { 'X-CSRFToken': csrfToken }
    })
    .then(response => response.json())
    .then(data => {
        const youtubeList = document.getElementById('youtube-list');
        const filesList = document.getElementById('files-list');
        const linksList = document.getElementById('links-list');
        
        youtubeList.innerHTML = '';
        filesList.innerHTML = '';
        linksList.innerHTML = '';
        
        data.media.forEach(media => {
            const html = createMediaItemHtml(media);
            if (media.media_type === 'youtube') {
                youtubeList.innerHTML += html;
            } else if (media.media_type === 'file') {
                filesList.innerHTML += html;
            } else if (media.media_type === 'link') {
                linksList.innerHTML += html;
            }
        });
    });
}

function createMediaItemHtml(media) {
    let icon, details, insertBtn = '';
    if (media.media_type === 'youtube') {
        icon = '<i class="fab fa-youtube text-danger"></i>';
        details = `<a href="${media.url}" target="_blank">${media.url}</a>`;
        insertBtn = `<button type="button" class="btn btn-sm btn-outline-primary" onclick="quickInsertYouTube('${media.url}', '${(media.title || '').replace(/'/g, "\\'")}')"><i class="fas fa-plus"></i> Insert</button>`;
    } else if (media.media_type === 'file') {
        icon = '<i class="fas fa-file text-primary"></i>';
        details = `${media.file_name} (${media.file_size})`;
        insertBtn = `<button type="button" class="btn btn-sm btn-outline-primary" onclick="quickInsertFile('${media.file_path || ''}', '${(media.title || media.file_name || '').replace(/'/g, "\\'")}')"><i class="fas fa-plus"></i> Insert</button>`;
    } else if (media.media_type === 'link') {
        icon = '<i class="fas fa-external-link-alt text-info"></i>';
        details = `<a href="${media.url}" target="_blank">${media.url}</a>`;
        insertBtn = `<button type="button" class="btn btn-sm btn-outline-primary" onclick="quickInsertLink('${media.url}', '${(media.title || '').replace(/'/g, "\\'")}')"><i class="fas fa-plus"></i> Insert</button>`;
    }
    
    return `
        <div class="media-item" data-id="${media.id}">
            <div class="media-item-icon">${icon}</div>
            <div class="media-item-info">
                <div class="media-item-title">${media.title || 'Untitled'}</div>
                <div class="media-item-details">${details}</div>
            </div>
            <div class="media-item-actions">
                ${insertBtn}
                <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteMedia(${media.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `;
}

function quickInsertYouTube(url, title) {
    const embedUrl = getYouTubeEmbedUrl(url);
    if (embedUrl) {
        const html = `
<div class="embedded-video" data-type="youtube">
    ${title ? `<p class="video-caption"><strong>${title}</strong></p>` : ''}
    <div class="video-container">
        <iframe src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
</div>
<p><br></p>
`;
        insertHtmlAtCursor(html);
    }
}

function quickInsertFile(filePath, title) {
    const html = `<div class="embedded-file"><a href="/static/${filePath}" class="file-download-link" download><i class="fas fa-file-download"></i> ${title}</a></div>`;
    insertHtmlAtCursor(html);
}

function quickInsertLink(url, title) {
    const html = `<a href="${url}" target="_blank" rel="noopener noreferrer">${title || url}</a>`;
    insertHtmlAtCursor(html);
}

function addYouTubeVideo() {
    const title = document.getElementById('youtube-title').value.trim();
    const url = document.getElementById('youtube-url').value.trim();
    
    if (!url) {
        alert('Please enter a YouTube URL');
        return;
    }
    
    fetch(`/api/lessons/${lessonId}/media/youtube`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
        },
        body: JSON.stringify({ title: title || 'YouTube Video', url: url })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('youtube-title').value = '';
            document.getElementById('youtube-url').value = '';
            loadMediaItems();
        } else {
            alert(data.error || 'Error adding video');
        }
    });
}

function uploadFile() {
    const title = document.getElementById('file-title').value.trim();
    const fileInput = document.getElementById('file-upload');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('Please select a file');
        return;
    }
    
    const formData = new FormData();
    formData.append('file', file);
    formData.append('title', title || file.name);
    
    fetch(`/api/lessons/${lessonId}/media/file`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrfToken
        },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('file-title').value = '';
            fileInput.value = '';
            loadMediaItems();
        } else {
            alert(data.error || 'Error uploading file');
        }
    });
}

function addExternalLink() {
    const title = document.getElementById('link-title').value.trim();
    const url = document.getElementById('link-url').value.trim();
    
    if (!url) {
        alert('Please enter a URL');
        return;
    }
    
    fetch(`/api/lessons/${lessonId}/media/link`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
        },
        body: JSON.stringify({ title: title || 'External Link', url: url })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('link-title').value = '';
            document.getElementById('link-url').value = '';
            loadMediaItems();
        } else {
            alert(data.error || 'Error adding link');
        }
    });
}

function deleteMedia(mediaId) {
    if (!confirm('Are you sure you want to delete this item?')) return;
    
    fetch(`/api/lessons/media/${mediaId}`, {
        method: 'DELETE',
        headers: {
            'X-CSRFToken': csrfToken
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            loadMediaItems();
        } else {
            alert(data.error || 'Error deleting item');
        }
    });
}

loadMediaItems();
{% endif %}
</script>

<style>
    .inline-media-toolbar {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
        padding: 0.75rem;
        background: rgba(80, 227, 194, 0.1);
        border-radius: 8px;
        flex-wrap: wrap;
    }
    
    .toolbar-label {
        color: #f4f4f7;
        font-weight: 600;
        margin-right: 0.5rem;
    }
    
    .inline-media-btn {
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(255,255,255,0.15);
        color: #d9e6f2;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .inline-media-btn:hover {
        background: rgba(80, 227, 194, 0.2);
        border-color: #50e3c2;
        color: #fff;
    }
    
    .inline-media-btn .fab, .inline-media-btn .fas {
        font-size: 1rem;
    }
    
    .media-dialog {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
    }
    
    .media-dialog.hidden {
        display: none;
    }
    
    .media-dialog-content {
        background: #1a2332;
        border-radius: 12px;
        padding: 1.5rem;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    
    .media-dialog-content h4 {
        color: #fff;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .dialog-buttons {
        display: flex;
        gap: 0.75rem;
        justify-content: flex-end;
        margin-top: 1.5rem;
    }

    #quill-editor {
        min-height: 320px;
        background: #0f1720;
        border-radius: 8px;
        padding: 1rem;
        box-shadow: inset 0 6px 18px rgba(0,0,0,0.45);
    }

    .ql-toolbar.ql-snow {
        background: #0d1720;
        border-radius: 8px;
        margin-bottom: 0.5rem;
        border: 1px solid rgba(255,255,255,0.04);
    }

    .ql-editor {
        color: #d9e6f2;
        background: transparent;
        font-size: 16px;
        line-height: 1.6;
    }

    .ql-editor h1, .ql-editor h2, .ql-editor h3 {
        color: #50e3c2;
        margin-top: 0;
    }

    .ql-snow .ql-editor pre.ql-syntax {
        background: #0b1220;
        color: #c7d2e0;
        padding: 12px;
        border-radius: 6px;
        overflow: auto;
    }

    .media-management-section {
        background: rgba(255,255,255,0.03);
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 2rem;
    }

    .section-subtitle {
        color: #50e3c2;
        margin-bottom: 0.5rem;
    }

    .media-tabs {
        display: flex;
        gap: 0.5rem;
        margin: 1.5rem 0 1rem;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding-bottom: 0.5rem;
    }

    .media-tab {
        background: transparent;
        border: none;
        color: #8899aa;
        padding: 0.75rem 1.5rem;
        cursor: pointer;
        border-radius: 8px 8px 0 0;
        transition: all 0.2s;
    }

    .media-tab:hover {
        color: #fff;
        background: rgba(255,255,255,0.05);
    }

    .media-tab.active {
        color: #50e3c2;
        background: rgba(80, 227, 194, 0.1);
    }

    .media-tab-content {
        padding: 1rem 0;
    }

    .media-tab-content.hidden {
        display: none;
    }

    .media-form .form-row {
        display: flex;
        gap: 1rem;
        align-items: flex-end;
        flex-wrap: wrap;
    }

    .media-form .flex-grow {
        flex: 1;
        min-width: 200px;
    }

    .media-list {
        margin-top: 1rem;
    }

    .media-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: rgba(255,255,255,0.03);
        border-radius: 8px;
        margin-bottom: 0.5rem;
    }

    .media-item-icon {
        font-size: 1.5rem;
        width: 40px;
        text-align: center;
    }

    .media-item-info {
        flex: 1;
    }

    .media-item-title {
        font-weight: 600;
        color: #fff;
    }

    .media-item-details {
        font-size: 0.85rem;
        color: #8899aa;
    }

    .media-item-details a {
        color: #50e3c2;
    }

    .media-item-actions {
        display: flex;
        gap: 0.5rem;
    }

    .text-danger { color: #ff4444; }
    .text-primary { color: #4a90d9; }
    .text-info { color: #17a2b8; }

    /* =========================================================
   LIGHT MODE FIX â€” QUILL + INLINE MEDIA
   (NO layout changes, colors only)
   ========================================================= */

[data-bs-theme="light"] .inline-media-toolbar {
    background: #f1f5f9;
}

[data-bs-theme="light"] .toolbar-label {
    color: #0f172a;
}

[data-bs-theme="light"] .inline-media-btn {
    background: #ffffff;
    border-color: #d1d5db;
    color: #0f172a;
}

[data-bs-theme="light"] .inline-media-btn:hover {
    background: #e2e8f0;
    border-color: #94a3b8;
    color: #020617;
}

/* ===== QUILL TOOLBAR ===== */

[data-bs-theme="light"] .ql-toolbar.ql-snow {
    background: #ffffff;
    border-color: #e5e7eb;
}

[data-bs-theme="light"] .ql-toolbar button,
[data-bs-theme="light"] .ql-toolbar .ql-picker-label,
[data-bs-theme="light"] .ql-toolbar .ql-picker-item {
    color: #0f172a !important;
    fill: #0f172a !important;
    stroke: #0f172a !important;
}

[data-bs-theme="light"] .ql-toolbar button:hover,
[data-bs-theme="light"] .ql-toolbar button.ql-active {
    background: #e2e8f0;
}

/* ===== QUILL EDITOR BODY ===== */

[data-bs-theme="light"] #quill-editor {
    background: #ffffff;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.08);
}

[data-bs-theme="light"] .ql-editor {
    color: #0f172a;
}

[data-bs-theme="light"] .ql-editor h1,
[data-bs-theme="light"] .ql-editor h2,
[data-bs-theme="light"] .ql-editor h3 {
    color: #0f172a;
}

[data-bs-theme="light"] .ql-editor pre.ql-syntax {
    background: #f8fafc;
    color: #020617;
}

/* ===== MEDIA DIALOGS ===== */

[data-bs-theme="light"] .media-dialog-content {
    background: #ffffff;
    color: #0f172a;
}

[data-bs-theme="light"] .media-dialog-content h4 {
    color: #0f172a;
}

[data-bs-theme="light"] .media-item {
    background: #f9fafb;
}

[data-bs-theme="light"] .media-item-title {
    color: #0f172a;
}

[data-bs-theme="light"] .media-item-details {
    color: #475569;
}

[data-bs-theme="light"] .media-item-details a {
    color: #2563eb;
}

/* ===== ICON VISIBILITY FIX ===== */

[data-bs-theme="light"] .fab,
[data-bs-theme="light"] .fas {
    color: #0f172a;
}

</style>
{% endblock %}
